// 1ï¸âƒ£ Show and hide side menu when pressing the "Burger" button
document.getElementById("burger-menu-btn").addEventListener("click", function () {
  document.getElementById("sidebar").classList.toggle("active");
});
// 2ï¸âƒ£ Hide side menu when clicking anywhere outside it
window.addEventListener("click", function (event) {
  const sidebar = document.getElementById("sidebar");
  const burgerMenuBtn = document.getElementById("burger-menu-btn");
  if (!sidebar.contains(event.target) && !burgerMenuBtn.contains(event.target)) {
    sidebar.classList.remove("active");
  }
});
// 3ï¸âƒ£ Add a "stabilization" effect to the top bar when scrolling down
window.addEventListener("scroll", function () {
  const navbar = document.querySelector("header");
  navbar.classList.toggle("sticky", window.scrollY > 0);
});
// 4ï¸âƒ£ Show and hide user menu when clicking on their name or photo
document.querySelectorAll("#username, #profile-photo").forEach((element) => {
  element.addEventListener("click", function () {
    const dropdownMenu = document.getElementById("dropdown-menu");
    dropdownMenu.style.display = dropdownMenu.style.display === "none" ? "block" : "none";
  });
});
// 5ï¸âƒ£ Hide user menu when clicking anywhere outside
window.addEventListener("click", function (event) {
  const dropdownMenu = document.getElementById("dropdown-menu");
  const username = document.getElementById("username");
  const profilePhoto = document.getElementById("profile-photo");
  if (!dropdownMenu.contains(event.target) && !username.contains(event.target) && !profilePhoto.contains(event.target)) {
    dropdownMenu.style.display = "none";
  }
});
// 6ï¸âƒ£ Check and block user session if not logged in
const userSession = JSON.parse(sessionStorage.getItem("userSession") || "{}");
const loggedIn = userSession.loggedIn || false;

if (!loggedIn) {
  alert("Unauthorized access detected. You have been banned permanently.");
  localStorage.setItem("banned", "true");
  window.location.href = "01-Welcome-Page.html";
}
// 7ï¸âƒ£ Display username in page with first capital letter
const username = userSession.username.charAt(0).toUpperCase() + userSession.username.slice(1);
document.querySelectorAll("#username").forEach((element) => {
  element.textContent = username;
});
// 8ï¸âƒ£ Download current question and show answers while identifying correct and false
const userAnswers = userSession.userAnswers;
const selectedQuestions = userSession.selectedQuestions;

function loadQuestion(index) {
  const questionData = selectedQuestions[index];
  const userAnswerData = userAnswers.find(answer => answer.questionID === questionData.questionId);
  document.querySelector(".qs-num").textContent = index + 1;
  document.querySelector(".question-text").textContent = questionData.question;
  const answersContainer = document.querySelector(".answers-container");
  answersContainer.innerHTML = "";
  questionData.answers.forEach((answer, i) => {
    const answerOption = document.createElement("div");
    answerOption.classList.add("answer-option");
    if (answer === userAnswerData.correct) {
      answerOption.classList.add("correct-answer");
    }
    if (answer === userAnswerData.userAnswer && !userAnswerData.userCorrect) {
      answerOption.classList.add("user-answer");
    }
    answerOption.innerHTML = `
      <span class="answer-circle">${String.fromCharCode(65 + i)}</span>
      <span class="answer-text">${answer}</span>
    `;
    answersContainer.appendChild(answerOption);
  });
}
// 9ï¸âƒ£ Update question navigation buttons and color selection
function updateQuestionNav() {
  const questionNav = document.querySelector(".question-nav");
  questionNav.innerHTML = "";
  userAnswers.forEach((answer, index) => {
    const questionBox = document.createElement("a");
    questionBox.classList.add("question-box");
    questionBox.textContent = index + 1;
    questionBox.style.backgroundColor = answer.userCorrect ? "lightgreen" : "lightcoral";
    questionBox.addEventListener("click", function () {
      document.querySelectorAll(".question-box").forEach(box => {
        box.classList.remove("selected");
      });
      questionBox.classList.add("selected");
      loadQuestion(index);
    });
    questionBox.addEventListener("mouseover", function () {
      questionBox.style.backgroundColor = "lightblue";
    });
    questionBox.addEventListener("mouseout", function () {
      questionBox.style.backgroundColor = answer.userCorrect ? "lightgreen" : "lightcoral";
    });
    questionNav.appendChild(questionBox);
  });
}
// ðŸ”Ÿ Load the first question when you run the page
updateQuestionNav();
loadQuestion(0);
// Redirect to choose a new topic when you click the "New test" button
document.getElementById("new-quiz-btn").addEventListener("click", function () {
  window.location.href = "04-Quiz-Select-Topic.html";
});
// User logout when clicking the "Sign Out" button
document.getElementById("logout-link").addEventListener("click", function () {
  sessionStorage.removeItem("userSession");
  sessionStorage.removeItem("loggedIn");
  sessionStorage.removeItem("fromWelcomePage");
  sessionStorage.removeItem("fromSignupPage");
  window.location.href = "01-Welcome-Page.html";
});
